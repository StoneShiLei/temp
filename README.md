# 采销库存系统 - 文档中心

欢迎查阅采销库存系统的完整技术文档。本文档中心包含系统的业务流程、架构设计、数据字典等详细说明。

---

## 📚 文档索引

### 1. [业务流程说明](./业务流程说明.md)

**适合人群**：产品经理、业务人员、新入职开发人员

**内容概要**：
- 系统概述和核心特性
- 核心实体说明（销售单、采购单、资产等）
- 三种业务类型详解（租赁、以租代售、销售）
- 完整业务流程说明（从创建到完成）
- 关键业务规则（修改、删除、快照机制等）
- 异常处理流程（退租、中止、故障等）
- 常见问题FAQ

**推荐阅读顺序**：⭐ 首先阅读

---

### 2. [业务流程图](./业务流程图.md)

**适合人群**：所有人员

**内容概要**：
- 主业务流程图（销售单完整生命周期）
- 商品分配流程图
- 采购完成流程图
- 订单执行流程图
- 状态机图（5种实体的状态流转）
- 退租和中止流程图
- 快照机制流程图
- 租金计算流程图
- 编号生成流程图
- 定时任务流程图

**使用工具**：支持 Mermaid 的 Markdown 查看器（VS Code、GitHub、Typora等）

**推荐阅读顺序**：⭐ 配合业务流程说明阅读

---

### 3. [架构优化建议](./架构优化建议.md)

**适合人群**：架构师、技术负责人、高级开发人员

**内容概要**：
- 当前架构分析（循环依赖问题）
- **优化方案1：领域事件模式**
  - 完整实现示例代码
  - 优缺点分析
- **优化方案2：协调服务模式** ⭐ 推荐
  - 完整实现示例代码
  - 优缺点分析
- **优化方案3：MediatR模式**
  - 完整实现示例代码
  - 优缺点分析
- 方案对比和综合推荐
- 重构路线图（10-13周实施计划）

**推荐阅读顺序**：了解业务后阅读

---

### 4. [数据字典](./数据字典.md)

**适合人群**：开发人员、DBA、测试人员

**内容概要**：
- 核心业务实体（10张表）
  - 销售单、商品需求、采购单、资产、租期、收款单、客户、收货地址、商品实例等
- 关联关系表（2张表）
  - 需求-资产关联、需求-采购单关联
- 日志记录表（3张表）
  - 销售单状态日志、采购单状态日志、资产状态和地址日志
- 枚举类型定义（10个枚举）
- 数据约束说明（唯一性、业务逻辑、完整性）

**推荐阅读顺序**：开发和维护时参考

---

### 5. [操作权限矩阵](./操作权限矩阵.md)

**适合人群**：产品经理、测试人员、开发人员

**内容概要**：
- 销售单操作权限矩阵（字段修改、操作权限）
- 采购单操作权限矩阵
- 资产操作权限矩阵
- 商品需求操作权限
- 租期管理操作权限
- 收款单操作权限
- 操作触发的状态变更
- 不同角色的典型权限建议
- 常见场景权限问题FAQ

**推荐阅读顺序**：测试和权限配置时参考

---

## 🚀 快速开始

### 新人入职必读

如果你是新入职的开发人员，推荐按以下顺序阅读：

1. **第一天**：[业务流程说明](./业务流程说明.md) - 第1-3章
   - 了解系统是做什么的
   - 了解三种业务类型的区别
   - 理解核心实体的作用

2. **第二天**：[业务流程图](./业务流程图.md) + [业务流程说明](./业务流程说明.md) - 第4章
   - 查看主业务流程图
   - 阅读完整业务流程说明
   - 理解从创建到完成的全链路

3. **第三天**：[业务流程说明](./业务流程说明.md) - 第5-6章 + [操作权限矩阵](./操作权限矩阵.md)
   - 理解状态流转规则
   - 掌握关键业务规则
   - 了解什么时候可以修改什么数据

4. **第四天**：[数据字典](./数据字典.md)
   - 查看数据表结构
   - 理解字段含义
   - 掌握数据约束

5. **第五天**：[架构优化建议](./架构优化建议.md)（可选）
   - 了解系统的架构设计
   - 理解循环依赖问题
   - 学习未来的优化方向

---

### 测试人员必读

如果你是测试人员，推荐关注：

1. [业务流程说明](./业务流程说明.md) - 了解业务规则
2. [业务流程图](./业务流程图.md) - 了解流程分支
3. [操作权限矩阵](./操作权限矩阵.md) - 了解操作限制
4. **测试重点**：
   - 状态流转的各个路径
   - 边界条件和异常场景
   - 权限控制和数据约束

---

### 产品经理必读

如果你是产品经理，推荐关注：

1. [业务流程说明](./业务流程说明.md) - 第1-4章：了解系统功能和流程
2. [业务流程图](./业务流程图.md) - 主业务流程图和状态机图
3. [操作权限矩阵](./操作权限矩阵.md) - 了解操作限制和用户体验
4. **关注点**：
   - 用户操作的限制和提示
   - 异常场景的处理方式
   - 功能优化的可能性

---

## 🔧 系统架构

### 技术栈

- **后端框架**：ASP.NET Core 6.0
- **ORM框架**：SqlSugar
- **数据库**：SQL Server
- **前端框架**：Vue 3
- **UI组件**：Element Plus
- **任务调度**：Quartz.NET
- **消息通知**：钉钉机器人

### 分层架构

```
┌─────────────────────────────────────┐
│      Presentation Layer             │
│   (Controllers, Vue Components)     │
└─────────────┬───────────────────────┘
              │
┌─────────────▼───────────────────────┐
│       Application Layer              │
│         (Services)                   │
│  - SalesOrderService                 │
│  - PurchaseOrderService              │
│  - AssetService                      │
│  - PaymentRecordService              │
│  - LeasePeriodService                │
└─────────────┬───────────────────────┘
              │
┌─────────────▼───────────────────────┐
│        Domain Layer                  │
│    (Models, Entities)                │
└─────────────┬───────────────────────┘
              │
┌─────────────▼───────────────────────┐
│    Infrastructure Layer              │
│  (Repository, Database, ORM)         │
└──────────────────────────────────────┘
```

---

## 📊 业务数据概览

### 核心实体数量

- **销售单**：主业务实体，记录客户订单
- **商品需求**：平均每个销售单 2-5 个需求
- **采购单**：根据需求动态创建
- **资产**：库存设备，可重复租赁
- **租期**：租赁业务专用，每个资产一条
- **收款单**：
  - 押金/销售款：每个销售单1条
  - 租金：每个资产按租期月数生成多条

### 关键业务指标

- **销售单编号格式**：`TR-{业务类型}-{工号}-{日期}-{流水}`
- **采购单编号格式**：`PO{日期}{流水}`
- **资产编码格式**：自定义（建议：`AS-{年份}-{流水}`）
- **每日单量上限**：
  - 销售单：每人每业务类型99单
  - 采购单：全局9999单

---

## 🎯 关键业务规则速查

| 规则 | 说明 | 代码参考 |
|-----|------|---------|
| **快照机制** | 客户和地址在订单创建时保存快照 | `SalesOrderService.cs:221-278` |
| **顺序流转** | 采购单只能顺序流转，不能跳跃 | `PurchaseOrderService.cs:1110-1130` |
| **自动完成** | 租期到期自动更新销售单为已完成 | `Job_LeaseExpiration.cs` |
| **智能分配** | 资产分配优先匹配地址和闲置时间 | `SalesOrderService.cs:883-922` |
| **租金计算** | 考虑赠送天数、增配价格、资源费 | `PaymentRecordService.cs:437-467` |
| **编号唯一** | 使用互斥锁保证编号生成的并发安全 | `SalesOrderService.cs:774` |

---

## 🔗 相关链接

- **项目仓库**：（填写你的Git仓库地址）
- **API文档**：（填写Swagger地址）
- **测试环境**：（填写测试环境地址）
- **生产环境**：（填写生产环境地址）

---

## 📝 文档维护

### 文档更新原则

1. **代码先行**：先修改代码，再更新文档
2. **同步更新**：重大功能变更必须同步更新文档
3. **版本管理**：文档包含版本号和更新日期
4. **审查机制**：文档更新需要团队审查

### 贡献指南

如果你发现文档有错误或需要补充，请：

1. 提交Issue说明问题
2. 或者直接修改文档，提交Pull Request
3. 注明修改原因和影响范围
4. 等待审查和合并

---

## ❓ 获取帮助

如果阅读文档后仍有疑问，可以：

1. 查看[常见问题FAQ](./业务流程说明.md#8-常见问题faq)
2. 查看[操作权限问题FAQ](./操作权限矩阵.md#9-常见场景权限问题faq)
3. 联系技术负责人
4. 在团队群里提问

---

## 📅 更新历史

| 版本 | 日期 | 更新内容 | 更新人 |
|-----|------|---------|--------|
| 1.0 | 2025-01-26 | 初始版本，创建完整文档体系 | 开发团队 |

---

**维护团队**：开发团队  
**最后更新**：2025-01-26

